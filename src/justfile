# shellcheck shell=bash
# shellcheck disable=SC2148

deps:
    uv pip compile pyproject.toml -o requirements.lock
    uv pip install -r requirements.lock

run *ARGS: _create_venv
    uv run run.py {{ARGS}}

delete *ARGS: _create_venv
    uv run run.py delete {{ARGS}}

ingest *ARGS: # Run with defaults (AAPL, 2022)
    uv run -m src.bin.edgar_ingestion --json-logs {{ARGS}} 2>&1 | tee ingest.log

summarize:
    uv run run.py summarize --document-id 3 --template-id 2 --temperature 0.7

# test and lint outputs are logged to make it easy to include as llm context
test: _create_venv
    uv run -m pytest --cov=src.database --cov=src.ingestion --cov=src.api src/tests/ --json-report --json-report-file=test.log

lint *FLAGS: # lint --fix
    ~/.local/share/nvim/mason/bin/ruff check src {{FLAGS}} | tee lint.log